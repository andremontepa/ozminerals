#line 1 "c:/totvs/microsiga-teste/protheus/include\Protheus.ch"
#line 1 "c:/totvs/microsiga-teste/protheus/include\Dialog.ch"
#line 28 "Protheus.ch"
#line 1 "c:/totvs/microsiga-teste/protheus/include\Font.ch"
#line 29 "Protheus.ch"
#line 1 "c:/totvs/microsiga-teste/protheus/include\PTMenu.ch"
#line 31 "Protheus.ch"
#line 1 "c:/totvs/microsiga-teste/protheus/include\Print.ch"
#line 33 "Protheus.ch"
#line 1 "c:/totvs/microsiga-teste/protheus/include\Colors.ch"
#line 35 "Protheus.ch"
#line 1 "c:/totvs/microsiga-teste/protheus/include\Folder.ch"
#line 37 "Protheus.ch"
#line 1 "c:/totvs/microsiga-teste/protheus/include\msobject.ch"
#line 38 "Protheus.ch"
#line 1 "c:/totvs/microsiga-teste/protheus/include\VKey.ch"
#line 42 "Protheus.ch"
#line 1 "c:/totvs/microsiga-teste/protheus/include\WinApi.ch"
#line 44 "Protheus.ch"
#line 1 "c:/totvs/microsiga-teste/protheus/include\FWCommand.ch"
#line 47 "Protheus.ch"
#line 1 "c:/totvs/microsiga-teste/protheus/include\FWCSS.CH"
#line 50 "Protheus.ch"
#line 2 "c:\totvs\projetos_prod\3..relatórios\compras\\c:/totvs/projetos_prod/3..relatórios/compras/rt02r001.prw"
#line 1 "c:/totvs/microsiga-teste/protheus/include\TopConn.ch"
#line 14 "c:\totvs\projetos_prod\3..relatórios\compras\\c:/totvs/projetos_prod/3..relatórios/compras/rt02r001.prw"

	Function U_RT02R001()


	Local cTitulo		:= "Pedido de Compra"
	Private cEmpresa	:= Substr(CNUMEMP,1,2)

	If FunName() == "MATA121"

			If GET_DAD()
				Processa( {||PROC_DAD()}, cTitulo, "Imprimindo Pedido de Compra" , .T. )
				TMP1->(DbCloseArea())
				TMP2->(DbCloseArea())
			Else
				Aviso("RT02R001","NÃ£o HÃ¡ dados para o Pedido de Compra Informado.",{"Fechar"},1)
			EndIf

	Else
		If GeraPar()
			If GET_DAD()
				Processa( {||PROC_DAD()}, cTitulo, "Imprimindo Pedido de Compra" , .T. )
				TMP1->(DbCloseArea())
				TMP2->(DbCloseArea())
			Else
				Aviso("RT02R001","NÃ£o HÃ¡ dados para o Pedido de Compra Informado.",{"Fechar"},1)
			EndIf
   		EndIf
	EndIF

Return










	Static Function PROC_DAD()


	Local cDirDocs	:= ""
	Local cArq		:= "RT02R001.html"
	Local nHandle	:= ""
	Local QBLINHA	:= chr(13)+chr(10)
	Local cPathTmp	:= ""
	Local cNomeEmp	:= ""
	Local cEndEmp	:= ""
	Local cCepEmp	:= ""
	Local cCidEmp	:= ""
	Local cCICEmp	:= ""
	Local cIEEmp	:= ""
	Local cCodFil	:= ""
	Local cNomeFil	:= ""
	Local cBaiEmp	:= ""
	Local cTelEmp	:= ""
	Local cLocEnt	:= ""
	Local cObs		:= ""
	Local nQtdMerc	:= 0
	Local nTotIPI	:= 0
	Local nTotICM	:= 0
	Local nTotDesc	:= 0
	Local nTotGer	:= 0
	Local nTotBru	:= 0
	Local nTotRat	:= 0
	Local cStatus	:= ""
	Local cComp		:= ""
	Local cNumPed	:= ""
	Local cCodRat	:= ""
	Local cFilC7	:= ""
	Local cTransp	:= ""
	Local cNomeTrp  := ""
	Local cEndTrp   := ""
	Local cCepTrp   := ""
	Local cTelTrp   := ""

	cDirDocs := MsDocPath()

	If File(cDirDocs+"\"+cArq)
		FErase(cDirDocs+"\"+cArq)
	EndIf

	nHandle := FCreate(cDirDocs+"\"+cArq,0)

	cNomeEmp	:= Alltrim(Posicione("SM0",1,cEmpresa+TMP1->FILIAL,"M0_NOMECOM"))
	cCodFil		:= Alltrim(Posicione("SM0",1,cEmpresa+TMP1->FILIAL,"M0_CODFIL"))
	cNomeFil	:= Alltrim(Posicione("SM0",1,cEmpresa+TMP1->FILIAL,"M0_FILIAL"))
	cEndEmp		:= Alltrim(Posicione("SM0",1,cEmpresa+TMP1->FILIAL,"M0_ENDCOB"))
	cCidEmp		:= Alltrim(Posicione("SM0",1,cEmpresa+TMP1->FILIAL,"M0_CIDCOB") +"-"+ Posicione("SM0",1,cEmpresa+TMP1->FILIAL,"M0_ESTCOB"))
	cCepEmp		:= Transform(Alltrim(Posicione("SM0",1,cEmpresa+TMP1->FILIAL,"M0_CEPCOB")),"@R 99.999-999")
	cIEEmp		:= Alltrim(Posicione("SM0",1,cEmpresa+TMP1->FILIAL,"M0_INSC"))
	cBaiEmp		:= Alltrim(Posicione("SM0",1,cEmpresa+TMP1->FILIAL,"M0_BAIRCOB"))
	cCICEmp		:= Transform(Posicione("SM0",1,cEmpresa+TMP1->FILIAL,"M0_CGC"),"@R 99.999.999/9999-99")
	cTelEmp		:= Transform(Posicione("SM0",1,cEmpresa+TMP1->FILIAL,"M0_TEL"),"@R (99) 99999-9999")
	cLocEnt		:= Alltrim(TMP1->LOCALENT) +" - "+ Alltrim(Posicione("SM0",1,cEmpresa+TMP1->LOCALENT,"M0_FILIAL"))+"/"+Alltrim(Posicione("SM0",1,cEmpresa+TMP1->LOCALENT,"M0_ESTCOB"))

	cObs		:= TMP1->OBS
	cStatus		:= Alltrim(TMP1->STATUS)
	cComp		:= Upper(TMP1->COMPRADOR)+" - "+Transform(TMP1->TELCOMP,"@R (99) 99999-9999")
	cNumPed		:= Alltrim(TMP1->NUMPED)
	cCodRat		:= Alltrim(TMP1->RAT)
	cFilC7		:= Alltrim(TMP1->FILIAL)
	cTransp 	:= Alltrim(TMP1->TRANSP)

	FWrite(nHandle,'  <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> '+QbLinha)
	FWrite(nHandle,'  <script src="/PSER/Template/JS/trim.js"></script> '+QbLinha)
	FWrite(nHandle,"  <html> "+QbLinha)
	FWrite(nHandle,"  	<head> "+QbLinha)
	FWrite(nHandle,'  		<meta charset="UTF-8"/> '+QbLinha)
	FWrite(nHandle,"  	</head> "+QbLinha)
	FWrite(nHandle,"  	<title>Pedido de Compra</title> "+QbLinha)
	FWrite(nHandle,'  	<style type = "text/css"> '+QbLinha)
	FWrite(nHandle,"  		*{Margin:0; Padding:0 font-family:Arial, Helvetica, sans-serif;} "+QbLinha)
	FWrite(nHandle,"  		@media print{@page{size:portrait;}} "+QbLinha)
	FWrite(nHandle,"  		form {margin:0 auto; width:auto; padding:1em; } "+QbLinha)
	FWrite(nHandle,"  		#esq { position:relative; float:left;} "+QbLinha)
	FWrite(nHandle,"  		#mei { position:relative; float:center;} "+QbLinha)
	FWrite(nHandle,"  		#dir { position:relative; float:right; border:1px; solid #000000;} "+QbLinha)
	FWrite(nHandle,"  		hr{border-color:#000000; box-sizing:border-box; width:100%;} "+QbLinha)
	FWrite(nHandle,"  		.td {border:0.5px solid #C0C0C0; border-left:none; border-right:none; font-size:12px;} "+QbLinha)
	FWrite(nHandle,"  		.table{font-size:12px;} "+QbLinha)
	FWrite(nHandle,"  		thead { "+QbLinha)
	FWrite(nHandle,"  				display: table-header-group; "+QbLinha)
	FWrite(nHandle,"  				counter-reset: page_number; "+QbLinha)
	FWrite(nHandle,"  			} "+QbLinha)
	FWrite(nHandle,"  		#page-number:after { "+QbLinha)
	FWrite(nHandle,"  counter-increment: page_number; "+QbLinha)
	FWrite(nHandle,"  content: counter(page_number); "+QbLinha)
	FWrite(nHandle,"  } "+QbLinha)
	FWrite(nHandle,"  	</style> "+QbLinha)
	FWrite(nHandle,'  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> '+QbLinha)
	FWrite(nHandle,"  	<body> "+QbLinha)
	FWrite(nHandle,"  		<form> "+QbLinha)
	FWrite(nHandle,'  			<table style = " width:100%; border-top:3px; solid #000000; border-button:10px double #000000;" > '+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td> "+QbLinha)
	FWrite(nHandle,"  						<h5>"+cNomeEmp+"</h5> "+QbLinha)
	FWrite(nHandle,"  						<h6>"+cEndEmp+" - "+cBaiEmp+"</h6> "+QbLinha)
	FWrite(nHandle,"  						<h6>"+cCidEmp+" - CEP: "+cCepEmp+"</h6> "+QbLinha)
	FWrite(nHandle,"  						<h6>Ozminerals.com</h6> "+QbLinha)
	FWrite(nHandle,"  						<h6>CNPJ: "+cCICEmp+" &nbsp;&nbsp;&nbsp;&nbsp; I.E: "+cIEEmp+"</h6> "+QbLinha)


	FWrite(nHandle,"  					</td> "+QbLinha)
	FWrite(nHandle,'  					<td align = "center" id="mei"> '+QbLinha)
	FWrite(nHandle,"  						<h2>Pedido de Compras</h2> "+QbLinha)
	FWrite(nHandle,' 						<b><h3 align = "center">'+TMP1->NUMPED+"</h3></b> "+QbLinha)
	FWrite(nHandle,' 						<b><h3 align = "center">'+SUBSTR(TMP1->DATA,7,2) +"/"+ SUBSTR(TMP1->DATA,5,2) +"/"+ SUBSTR(TMP1->DATA,1,4)+"</h3></b> "+QbLinha)
	FWrite(nHandle,"  					</td> "+QbLinha)

	FWrite(nHandle,'  					<td id="dir"><img style = " margin-top:-15px;" width=190px height=75px src = "https://fa09ae68-a-eb1a3c69-s-sites.googlegroups.com/a/equilibrioti.com.br/equilibrioti/logoavb/logo-avanco-oz.png?attachauth=ANoY7cpq6eDO-lmMmuQE2OijS-ks_QOfAlr4nBuIglx-RGeph5eZrmCHRWGePIS0qs3Z8XelZCl54U-iJbuUZfgVIjIF6wU2GpzZgQNMMSsVCumPCD0yzeTo06RFHcDbxWKU_bjcmBstupzemYGjURRSrSefpVtAPJvUGMFSJfuKp9A46PXuPcBIsqzAhjUogS0UFWMERZEzvSFzAn_SK1uFugqlXbD-hPk0JNZbr3vwxXiRrCXWsFI%3D&attredirects=0" ></td> '+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  			</table> "+QbLinha)
	FWrite(nHandle,"  			<hr></hr> "+QbLinha)
	FWrite(nHandle,'  			<table cellpadding="2" cellspacing="0" border="0" width = 100% style = "margin:10px auto;" class="table"> '+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Fornecedor:</b></td> "+QbLinha)
	FWrite(nHandle,"  					<td>"+TMP1->FORNECEDOR+"</td> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Tipo Frete:</b></td> "+QbLinha)
	FWrite(nHandle,"  					<td>"+TMP1->FRETE+"</td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Endere&ccedil;o:</b></td> "+QbLinha)
	FWrite(nHandle,"  					<td>"+TMP1->ENDERECO+"</td> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Local Entrega:</b></td> "+QbLinha)
	FWrite(nHandle,"  					<td>"+cLocEnt+"</td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Municipio/UF:</b></td> "+QbLinha)
	FWrite(nHandle,"  					<td>"+TMP1->CIDADEUF+"</td> "+QbLinha)
	FWrite(nHandle,"  					<td><b>CEP:</b></td> "+QbLinha)
	FWrite(nHandle,"  					<td>"+Alltrim(TMP1->CEP)+"</td> "+QbLinha)

	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Telefone:</b></td> "+QbLinha)
	FWrite(nHandle,"  					<td>"+TMP1->TELEFONE+"</td> "+QbLinha)
	FWrite(nHandle,"  					<td><b>CPF/CNPJ:</b></td> "+QbLinha)
	FWrite(nHandle,"  					<td>"+Transform(TMP1->CNPJ,"@R 99.999.999/9999-99")+"</td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Contato:</b></td> "+QbLinha)
	FWrite(nHandle,"  					<td>"+Alltrim(TMP1->CONTATO)+"</td> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Email:</b></td> "+QbLinha)
	FWrite(nHandle,"  					<td>"+TMP1->EMAIL+"</td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle," 					<td><b>Cond. Pagamento:</b></td> "+QbLinha)
	FWrite(nHandle,"  					<td>"+TMP1->CONDPAG+"</td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  			</table> "+QbLinha)
	FWrite(nHandle,'  			<table class="td" cellpadding="2" cellspacing="0" border="1" align = "center" bordercolor="#C0C0C0" width = 100%  style = "margin:3px auto;"> '+QbLinha)
	FWrite(nHandle,'  				<tr class="td"> '+QbLinha)
	FWrite(nHandle,'  					<td align = "center"><b>ITEM</b></td> '+QbLinha)
	FWrite(nHandle,'  					<td align = "center"><b>C&Oacute;DIGO</b></td> '+QbLinha)
	FWrite(nHandle,'  					<td align = "center"><b>DESCRI&Ccedil;&Atilde;O</b></td> '+QbLinha)
	FWrite(nHandle,'  					<td align = "center"><b>UM</b></td> '+QbLinha)
	FWrite(nHandle,' 					<td align = "center"><b>TA</b></td> '+QbLinha)
	FWrite(nHandle,'  					<td align = "center"><b>DT. Entrega</b></td> '+QbLinha)
	FWrite(nHandle,'  					<td align = "center"><b>QTD</b></td> '+QbLinha)
	FWrite(nHandle,'  					<td align = "center"><b>VLR UNIT</b></td> '+QbLinha)
	FWrite(nHandle,'  					<td align = "center"><b>IPI%</b></td> '+QbLinha)
	FWrite(nHandle,'  					<td align = "center"><b>VLR TOTAL</b></td> '+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)

	While ! TMP1->(EOF())
		FWrite(nHandle,"  				<tr > "+QbLinha)
		FWrite(nHandle,'  					<td align = "center">'+Alltrim(TMP1->ITEM)+"</td> "+QbLinha)
		FWrite(nHandle,'  					<td align = "center">'+Alltrim(TMP1->CODPRD)+"</td> "+QbLinha)
		FWrite(nHandle,'  					<td align = "left">'+Alltrim(TMP1->DESCPRD)+"</td> "+QbLinha)
		FWrite(nHandle,'  					<td align = "center">'+Alltrim(TMP1->UM)+"</td> "+QbLinha)
		FWrite(nHandle,' 					<td align = "center">'+TMP1->TPAPL+"</td> "+QbLinha)
		FWrite(nHandle,'  					<td align = "center">'+SUBSTR(TMP1->DATAENT,7,2) +"/"+ SUBSTR(TMP1->DATAENT,5,2) +"/"+ SUBSTR(TMP1->DATAENT,1,4)+"</td> "+QbLinha)
		FWrite(nHandle,'  					<td align = "right">'+Transform(TMP1->QTD,"@E 999,999.999")+"</td> "+QbLinha)
		FWrite(nHandle,'  					<td align = "right">'+Transform(TMP1->VLRUNIT,"@E 999,999,999.999")+"</td> "+QbLinha)
		FWrite(nHandle,'  					<td align = "right">'+Transform(TMP1->PERCIPI,"@E 99.99")+"</td> "+QbLinha)
		FWrite(nHandle,'  					<td align = "right">'+Transform(TMP1->TOTAL,"@E 999,999,999.99")+"</td> "+QbLinha)
		FWrite(nHandle,"  				<tr> "+QbLinha)

		nQtdMerc 	+= TMP1->QTD
		nTotIPI		+= TMP1->VLRIPI
		nTotICM		+= TMP1->VLRICMS
		nTotDesc	+= TMP1->DESCONTO
		nTotBru		+= TMP1->TOTALBRUTO
		nTotGer		+= TMP1->TOTAL

		TMP1->(DBSKIP())
	End

	FWrite(nHandle,"  			</table> "+QbLinha)
	FWrite(nHandle,"  			<br> "+QbLinha)

	GET_RAT(cCodRat,cFilC7,cNumPed)

	FWrite(nHandle,'  			<table class="td" cellpadding="2" cellspacing="0" border="1" align = "left" bordercolor="#C0C0C0" width = 20% style = "margin:3px auto;"> '+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,'  					<td colspan="3" align = "center"><b>RATEIOS</b></td> '+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,'  					<td align = "center"><b>Centro de Custo</b></td> '+QbLinha)
	FWrite(nHandle,'  					<td align = "center"><b>Item Contabil</b></td> '+QbLinha)
	FWrite(nHandle,'  					<td align = "right"><b>Valor</b></td> '+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)

	While ! TMP2->(EOF())

		FWrite(nHandle,"  				<tr> "+QbLinha)
		FWrite(nHandle,'  					<td align = "center">'+Alltrim(TMP2->CCUSTO)+"</td> "+QbLinha)
		FWrite(nHandle,'  					<td align = "center">'+Alltrim(TMP2->ITEMCTA)+"</td> "+QbLinha)
		FWrite(nHandle,'  					<td align = "right">'+Transform(TMP2->VLRRATEIO,"@E 999,999,999.99")+"</td> "+QbLinha)
		FWrite(nHandle,"  				</tr> "+QbLinha)

		nTotRat += TMP2->VLRRATEIO

		TMP2->(DbSkip())
	End

	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,'  					<td align = "left" colspan="2"><b>Total Geral</b></td> '+QbLinha)
	FWrite(nHandle,'  					<td align = "right">'+Transform(nTotRat,"@E 999,999,999.99")+"</td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  			</table> "+QbLinha)

	FWrite(nHandle,'  			<table class="td" cellpadding="2" cellspacing="0" border="1" align = "right" bordercolor="#C0C0C0" width = 30% style = "margin:3px auto;"> '+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Total Mercadorias</b></td> "+QbLinha)
	FWrite(nHandle,'  					<td align = "right">'+Transform(nTotBru,"@E 999,999,999.99")+"</td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Valor de I.P.I. (+)</b></td> "+QbLinha)
	FWrite(nHandle,'  					<td align = "right">'+Transform(nTotIPI,"@E 999,999.99")+"</td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Valor de Desconto (-)</b></td> "+QbLinha)
	FWrite(nHandle,'  					<td align = "right">'+Transform(nTotDesc,"@E 999,999.99")+"</td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><b>Total Geral</b></td> "+QbLinha)
	FWrite(nHandle,'  					<td align = "right">'+Transform(nTotGer,"@E 999,999,999.99")+"</td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  			</table> "+QbLinha)
	FWrite(nHandle,'  			<table cellpadding="2" cellspacing="0" border="0" width = 30% align = "center" style = "margin:20px auto;"> '+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><h3>"+cStatus+"</h3></td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  			</table> "+QbLinha)
	FWrite(nHandle,"  			<br><br> "+QbLinha)
	FWrite(nHandle,"  			<hr></hr> "+QbLinha)
	FWrite(nHandle,"  			<table> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><h4>Comprador: </h4></td> "+QbLinha)
	FWrite(nHandle,"  					<td><h4>"+cComp+"</h4></td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  			</table> "+QbLinha)
	FWrite(nHandle,"  			<hr></hr> "+QbLinha)
	FWrite(nHandle,"  			<h4><b>Observa&ccedil;&atilde;o:</b></h4> "+QbLinha)
	FWrite(nHandle,"  			<h5>"+cObs+"</h5> "+QbLinha)
	FWrite(nHandle,'  			<table cellpadding="1" cellspacing="0" border="1" border rules=cols align = "center" bordercolor="#000000" width = 100%  style = "margin:3px auto;"> '+QbLinha)

	cNomeTrp := Alltrim(Posicione("SA4",1,FWXFilial("SA4")+cTransp,"A4_NOME"))
	cEndTrp  := Alltrim(Posicione("SA4",1,FWXFilial("SA4")+cTransp,"A4_END"))
	cCepTrp  := Alltrim(Posicione("SA4",1,FWXFilial("SA4")+cTransp,"A4_CEP")) +" - "+ Alltrim(Posicione("SA4",1,FWXFilial("SA4")+cTransp,"A4_MUN")) +" - "+ Alltrim(Posicione("SA4",1,FWXFilial("SA4")+cTransp,"A4_EST"))
	cTelTrp  := Alltrim(Posicione("SA4",1,FWXFilial("SA4")+cTransp,"A4_DDD")) +" - "+ Alltrim(Posicione("SA4",1,FWXFilial("SA4")+cTransp,"A4_TEL"))

	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><h3><b>INFORMACOES PARA O FORNECEDOR</b></h3></td> "+QbLinha)
	FWrite(nHandle,"  					<td><h3><b>LOCAL DE ENTREGA</b></h3></td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><h6>O NUMERO DESTE PEDIDO DE COMPRAS DEVERA, NECESSARIAMENTE, SER MENCIONADO NA NOTA FISCAL.</h6></td> "+QbLinha)
	FWrite(nHandle,"  					<td><h6>"+cNomeTrp+"</h6></td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><h6> CASO CONTRARIO, NAO RECEBEREMOS SUA MERCADORIA / SERVICO!</h6></td> "+QbLinha)
	FWrite(nHandle,"  					<td><h6>"+cEndTrp+"</h6></td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><h6>Nao sera aceito pagamento via BOLETO BANCARIO;</h6></td> "+QbLinha)
	FWrite(nHandle,"  					<td><h6>CEP: "+cCepTrp+"</h6></td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><h6>Obrigatório enviar XML da NF-e para o E-mail: NFe.Carajas@ozminerals.com;</h6></td> "+QbLinha)
	FWrite(nHandle,"  					<td><h6>TEL: "+cTelTrp+"</h6></td> "+QbLinha)
	FWrite(nHandle,"  				</tr> "+QbLinha)
	FWrite(nHandle,"  				<tr> "+QbLinha)
	FWrite(nHandle,"  					<td><h6>E vedada a negociacao de titulos com terceiros provenientes deste pedido de compras;</h6></td> "+QbLinha)
	FWrite(nHandle,"  					<td></td> "+QbLinha)
	FWrite(nHandle,"  			<hr></hr> "+QbLinha)
	FWrite(nHandle,"  		</form> "+QbLinha)
	FWrite(nHandle,"  	</body> "+QbLinha)
	FWrite(nHandle,"  </html> "+QbLinha)

	FClose(nHandle)

	cPathTmp := Alltrim(GetTempPath())

	If File(cPathTmp+"\"+cArq)
		FErase(cPathTmp+"\"+cArq)
	EndIf

	CpyS2T(cDirDocs+"\"+cArq,cPathTmp, .t. )
	ShellExecute("open",cArq,"",cPathTmp,1)

Return










	Static Function GET_DAD()


	Local cQuery 		:= ""
	Local QBLINHA		:= chr(13)+chr(10)

	cQuery += " SELECT  "+QbLinha
    cQuery += " C7_FILIAL FILIAL "+QbLinha
    cQuery += " , C7_NUM NUMPED "+QbLinha
    cQuery += " , C7_EMISSAO DATA "+QbLinha
    cQuery += " , RTRIM(A2_NOME) +' ('+C7_FORNECE+' - '+C7_LOJA+')' FORNECEDOR "+QbLinha
    cQuery += " , RTRIM(A2_END)+' - '+A2_BAIRRO ENDERECO "+QbLinha
    cQuery += " , REPLACE(A2_MUN,' ','')+'/'+A2_EST CIDADEUF "+QbLinha
    cQuery += " , A2_DDD+A2_TEL TELEFONE "+QbLinha
    cQuery += " , A2_CONTATO CONTATO "+QbLinha
    cQuery += " , CASE "+QbLinha
    cQuery += "  WHEN C7_TPFRETE = 'C' THEN 'CIF' "+QbLinha
    cQuery += "  WHEN C7_TPFRETE = 'F' THEN 'FOB' "+QbLinha
    cQuery += "  ELSE 'SEM FRETE' "+QbLinha
    cQuery += "  END AS FRETE "+QbLinha
    cQuery += " , C7_COND+' - '+E4_DESCRI CONDPAG "+QbLinha
    cQuery += " , A2_CEP CEP "+QbLinha
    cQuery += " , A2_CGC CNPJ "+QbLinha
    cQuery += " , REPLACE(A2_EMAIL,' ','') EMAIL "+QbLinha
    cQuery += " , C7_ITEM ITEM "+QbLinha
    cQuery += " , REPLACE(C7_PRODUTO,' ','') CODPRD "+QbLinha
    cQuery += " , REPLACE(B1_ESPECIF,' ','') DESCPRD "+QbLinha
    cQuery += " , B1_TIPO TIPO "+QbLinha
    cQuery += " , REPLACE(C7_CC,' ','') CCUSTO "+QbLinha
    cQuery += " , REPLACE(C7_ITEMCTA,' ','') ITEMCTA "+QbLinha
    cQuery += " , C7_UM UM "+QbLinha
    cQuery += " , C7_QUANT QTD "+QbLinha
    cQuery += " , C7_PRECO VLRUNIT "+QbLinha
    cQuery += " , CASE WHEN B1_TIPO = 'SV' THEN 0 ELSE C7_IPI END AS PERCIPI "+QbLinha
    cQuery += " , CASE WHEN B1_TIPO = 'SV' THEN 0 ELSE C7_VALIPI END AS VLRIPI "+QbLinha
    cQuery += " , CASE WHEN B1_TIPO = 'SV' THEN 0 ELSE C7_PICM END AS PERCICMS "+QbLinha
    cQuery += " , CASE WHEN B1_TIPO = 'SV' THEN 0 ELSE C7_VALICM END AS VLRICMS "+QbLinha
    cQuery += " , CASE WHEN C7_IPI > 0 THEN (C7_TOTAL+C7_VALIPI)-(C7_VLDESC) ELSE (C7_TOTAL)-(C7_VLDESC) END AS TOTAL "+QbLinha
    cQuery += " , C7_TOTAL TOTALBRUTO "+QbLinha
    cQuery += " , C7_XTPAPL TPAPL "+QbLinha
    cQuery += " , C7_VLDESC DESCONTO "+QbLinha
    cQuery += " , C7_FILENT LOCALENT "+QbLinha
    cQuery += " , CASE "+QbLinha
    cQuery += "  WHEN C7_CONAPRO = 'B' THEN 'PEDIDO BLOQUEADO' "+QbLinha
    cQuery += "  WHEN C7_CONAPRO = 'L' THEN 'PEDIDO APROVADO' "+QbLinha
    cQuery += "  END AS STATUS "+QbLinha
    cQuery += " , Y1_NOME COMPRADOR "+QbLinha
    cQuery += " , Y1_TEL TELCOMP "+QbLinha
    cQuery += " , C7_RATEIO RAT"+QbLinha

    cQuery += " , ISNULL(CONVERT(VARCHAR(1024),C7_XOBSF),'') OBS "+QbLinha
    cQuery += " , C7_DATPRF DATAENT"+QbLinha
	cQuery += " , CASE WHEN C7_XTRANSP = '      ' THEN '999999' ELSE C7_XTRANSP END AS TRANSP "+QbLinha

    cQuery += "FROM "
    cQuery +=   RetSqlName("SC7") + " SC7 "+QBLINHA

    cQuery += "INNER JOIN "
    cQuery +=   RetSqlName("SA2") + " SA2 "+QBLINHA
    cQuery += " ON A2_COD = C7_FORNECE "+QbLinha
    cQuery += " AND A2_LOJA = C7_LOJA "+QbLinha
    cQuery += " AND SA2.D_E_L_E_T_ = ' '  "+QbLinha

    cQuery += "INNER JOIN "
    cQuery +=   RetSqlName("SB1") + " SB1 "+QBLINHA
    cQuery += " ON B1_COD = C7_PRODUTO "+QbLinha
    cQuery += " AND SB1.D_E_L_E_T_ = ' '  "+QbLinha

    cQuery += "INNER JOIN "
    cQuery +=   RetSqlName("SE4") + " SE4 "+QBLINHA
    cQuery += " ON E4_CODIGO = C7_COND "+QbLinha
    cQuery += " AND SE4.D_E_L_E_T_ = ' '  "+QbLinha

    cQuery += "LEFT OUTER JOIN "
    cQuery +=   RetSqlName("SY1") + " SY1 "+QBLINHA
    cQuery += " ON Y1_USER = C7_USER "+QbLinha
    cQuery += " AND SY1.D_E_L_E_T_ = ' '  "+QbLinha

    cQuery += " WHERE  "+QbLinha
    cQuery += " SC7.D_E_L_E_T_ = ' '  "+QbLinha
	If FunName() <> "MATA121"
	    cQuery += " AND C7_NUM = '"+MV_PAR02+"' "+QbLinha
	    cQuery += " AND C7_FILIAL = '"+MV_PAR01+"' "+QbLinha
    Else
	    cQuery += " AND C7_FILIAL = '"+SC7->C7_FILIAL+"' "+QbLinha
		cQuery += " AND C7_NUM = '"+SC7->C7_NUM+"' "+QbLinha
	Endif
	MEMOWRITE("C:/ricardo/RT02R001.sql",cQuery)
	cQuery := ChangeQuery(cQuery)
	DBUSEAREA( .T. , "TOPCONN", TcGenQry(,,cQuery), "TMP1", .F. , .T. )

	DBSELECTAREA("TMP1")
	TMP1->(DBGOTOP())
	NQTREG := 0; DBEval( {|| NQTREG := NQTREG + 1},,,,,.F. )
	TMP1->(DBGOTOP())

	If NQTREG <= 0
		TMP1->(DBCLOSEAREA())
		Return .F. 
	EndIf

Return .T. 










	Static Function GET_RAT(cRat,cEmp,cNum)


	Local cQuery 		:= ""
	Local QBLINHA		:= chr(13)+chr(10)

	cRat := If( cRat == nil, "2", cRat ) ;
	cEmp := If( cEmp == nil, "", cEmp ) ;
	cNum := If( cNum == nil, "", cNum ) ;

	If cRat == "1"

		cQuery := "SELECT "+QbLinha
		cQuery += "CH_CC CCUSTO "+QbLinha
		cQuery += ", CH_ITEMCTA ITEMCTA "+QbLinha
		cQuery += ", CASE WHEN C7_IPI > 0 THEN ((SUM((C7_TOTAL+C7_VALIPI)-(C7_VLDESC))*CH_PERC)/100) ELSE ((SUM((C7_TOTAL)-(C7_VLDESC))*CH_PERC)/100) END AS VLRRATEIO "+QbLinha

		cQuery += "FROM "
		cQuery +=  RetSqlName("SCH") + " SCH "+QBLINHA

		cQuery += "INNER JOIN "
		cQuery +=  RetSqlName("SC7") + " SC7 "+QBLINHA
		cQuery += "ON SC7.C7_FILIAL = SCH.CH_FILIAL "+QbLinha
		cQuery += "AND SC7.C7_NUM = SCH.CH_PEDIDO "+QbLinha
		cQuery += "AND SC7.C7_FORNECE = SCH.CH_FORNECE "+QbLinha
		cQuery += "AND SC7.C7_LOJA = SCH.CH_LOJA "+QbLinha
		cQuery += "AND SC7.C7_ITEM = SCH.CH_ITEMPD "+QbLinha
		cQuery += "AND SC7.D_E_L_E_T_ = ' ' "+QbLinha

		cQuery += "WHERE "+QbLinha
		cQuery += "SCH.D_E_L_E_T_ = ' ' "+QbLinha
		cQuery += "AND CH_FILIAL = '"+cEmp+"' "+QbLinha
		cQuery += "AND CH_PEDIDO = '"+cNum+"' "+QbLinha

		cQuery += "GROUP BY CH_CC, CH_ITEMCTA, CH_PERC, C7_IPI"

	Else

		cQuery := "SELECT "+QbLinha
		cQuery += "C7_CC CCUSTO "+QbLinha
		cQuery += ", C7_ITEMCTA ITEMCTA "+QbLinha
		cQuery += ", CASE WHEN C7_IPI > 0 THEN SUM((C7_TOTAL+C7_VALIPI)-(C7_VLDESC)) ELSE SUM((C7_TOTAL)-(C7_VLDESC)) END AS VLRRATEIO "+QbLinha

		cQuery += "FROM "
		cQuery +=  RetSqlName("SC7") + " SC7 "+QBLINHA
		cQuery += "WHERE SC7.D_E_L_E_T_ = ' ' "+QbLinha
		cQuery += "AND C7_FILIAL = '"+cEmp+"' "+QbLinha
		cQuery += "AND C7_NUM = '"+cNum+"' "+QbLinha
		cQuery += "GROUP BY C7_CC, C7_ITEMCTA, C7_IPI "+QbLinha

	EndIf

	MEMOWRITE("C:/ricardo/RT02R001A.sql",cQuery)
	cQuery := ChangeQuery(cQuery)
	DBUSEAREA( .T. , "TOPCONN", TcGenQry(,,cQuery), "TMP2", .F. , .T. )

	DBSELECTAREA("TMP2")
	TMP2->(DBGOTOP())
	NQTREG := 0; DBEval( {|| NQTREG := NQTREG + 1},,,,,.F. )
	TMP2->(DBGOTOP())

	If NQTREG <= 0
		TMP2->(DBCLOSEAREA())
		Return .F. 
	EndIf

Return










	Static Function GeraPar()


	Local aParambox		:= {}
	Local aRet 			:= {}


	AADD(aParamBox,{1,"Filial"		,Space(TamSX3("C7_FILIAL")[1])		,"","","SM0","",0, .T. })
	AADD(aParamBox,{1,"Pedido"		,Space(TamSX3("C7_NUM")[1])			,"","","SC7","",0, .T. })


	If !ParamBox(aParamBox,"Parametros",@aRet)
		Return .F. 
	Endif

Return .T. 
